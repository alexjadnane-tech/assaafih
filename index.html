<div class="grid" id="grid"></div>
<div id="selectedEdition">selected edition: <span id="editionNumber">Aucune</span></div>
<button id="payButton" style="display:none;">PAY!</button>

<script>
let selectedEdition = null;
const grid = document.getElementById('grid');
const editionNumber = document.getElementById('editionNumber');
const payButton = document.getElementById('payButton');

// Générer la grille
for (let i = 1; i <= 200; i++) {
  const div = document.createElement('div');
  div.className = 'edition';
  div.textContent = i;
  div.dataset.edition = i;

  div.addEventListener('click', () => {
    selectedEdition = i;
    editionNumber.textContent = i;
    payButton.style.display = 'inline-block';
  });

  grid.appendChild(div);
}

// Paiement
payButton.addEventListener('click', async () => {
  if (!selectedEdition) return;

  // Ici tu peux récupérer les infos du client via un formulaire ou prompt
  const customer = {
    name: prompt("Nom complet ?"),
    email: prompt("Email ?"),
    address: prompt("Adresse complète ?"),
    phone: prompt("Téléphone (optionnel)")
  };

  try {
    const res = await fetch('/api/payrexx', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({edition: selectedEdition, customer})
    });

    const data = await res.json();
    if (data.error) return alert(data.error);

    // Rediriger vers Payrexx
    window.location.href = data.url;
  } catch (err) {
    alert('Erreur: ' + err.message);
  }
});
</script>
